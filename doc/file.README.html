<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>
  File: README
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!file.README.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index</a> &raquo; 
    <span class="title">File: README</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><div id='filecontents'>
<h1 id="label-Alchemy+Flux">Alchemy Flux</h1>

<h2 id="label-Alchemy+Micro-services+Framework">Alchemy Micro-services Framework</h2>

<p>The Alchemy <a
href="http://martinfowler.com/articles/microservices.html">Micro-services</a>
Framework is a framework for creating many small interconnected services
that communicate over the RabbitMQ message brokering service. Building
services with Alchemy has many benefits, like:</p>
<ul><li>
<p><strong>High Availability</strong>: being able to run multiple services
across many different machines, communicating to a High Availability
RabbitMQ Cluster.</p>
</li><li>
<p><strong>Smart Load Balancing</strong>: running multiple instances of the
same service, will distribute messages to services based on the service
capacity and not via a simple round robin approach.</p>
</li><li>
<p><strong>Service Discovery</strong> Using RabbitMQ&#39;s routing of messages
means services can communicate without knowing where they are located.</p>
</li><li>
<p><strong>Deployment</strong> you can stop a service, then start a new
service without missing any messages because they are buffered on RabbitMQ.
Alternatively, you can run multiple versions of the same service
concurrently to do rolling deploys.</p>
</li><li>
<p><strong>Error Recovery</strong> If a service unexpectedly dies while
processing a message, the message can be reprocessed by another service.</p>
</li><li>
<p><strong>Polyglot Architecture</strong>: Each service can be implemented in
the language that best suites its domain.</p>
</li></ul>

<h2 id="label-How+Alchemy+Services+Work">How Alchemy Services Work</h2>

<p>An Alchemy service communicates by registering two queues, a
<strong>service queue</strong> (shared amongst all instances of a service)
and a <strong>response queue</strong> (unique to that service instance).
<em>For the purpose of clarity I will note a service with letters e.g.
<code>A</code>, <code>B</code> and service instances with numbers, e.g.
<code>A1</code> is service <code>A</code> instance <code>1</code>.</em></p>

<p>A service sends a message to another service by putting a message on its
<strong>service queue</strong> (this message includes the <strong>response
queue</strong> of the sender). An instance of that service will consume and
process the message then respond to the received <strong>response
queue</strong>. For example, if service <code>A1</code> wanted to message
service <code>B</code>:</p>

<pre class="code ruby"><code class="ruby">
|----------|                                                  |------------|
| RabbitMQ | &lt;-- 1. Send message on queue B   --------------- | Service A1 |
|          |                                                  |            |
|          | --- 2. Consume Message from B  -&gt; |------------| |            |
|          |                                   | Service B1 | |            |
|          | &lt;-- 3. Respond on queue A1     -- |------------| |            |
|          |                                                  |            |
|----------| --- 4. Receive response on A1  ----------------&gt; |------------|</code></pre>

<p>Alchemy tries to reuse another common communication protocol, HTTP, for
status codes, message formatting, headers and more. This way the basis of
the messaging protocol is much simpler to explain and implement.</p>

<p>Passing messages between services this way means that service
<code>A1</code> can send messages to <code>B</code> without knowing which
instance of <code>B</code> will process the message. If service
<code>B1</code> becomes overloaded we can see the queue build up messages,
and then start a new instance of service <code>B</code>, which, with zero
configuration changes, immediately start processing messages.</p>

<p>If the instance of <code>B</code> dies while processing a message, RabbitMQ
will put the message back on the queue which can then be processed by
another instance. This happens without the calling service knowing and so
this makes the system much more resilient to errors. However, this also
means that messages may be processed more than once, so implementing
<strong>idempotent</strong> micro-services is very important.</p>

<h2 id="label-Alchemy-Flux">Alchemy-Flux</h2>

<p>Alchemy-Flux is the Ruby implementation of the Alchemy Framework. Ruby is a
great language to write in and works well with the Alchemy style of
communication.</p>

<p>Flux is implemented using the <a
href="https://github.com/eventmachine/eventmachine">EventMachine</a> and <a
href="https://github.com/ruby-amqp/amqp">AMQP</a> gems.</p>

<h3 id="label-Getting+Started">Getting Started</h3>

<p>To install Alchemy-Flux:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_gem'>gem</span> <span class='id identifier rubyid_install'>install</span> <span class='id identifier rubyid_alchemy'>alchemy</span><span class='op'>-</span><span class='id identifier rubyid_flux'>flux</span>
</code></pre>

<p>To create instances of two services, <code>A</code> and <code>B</code>, and
have instance <code>A1</code> call service <code>B</code>:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>alchemy-flux</span><span class='tstring_end'>&#39;</span></span>

<span class='id identifier rubyid_service_a1'>service_a1</span> <span class='op'>=</span> <span class='const'>AlchemyFlux</span><span class='op'>::</span><span class='const'>Service</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>A</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

<span class='id identifier rubyid_service_b1'>service_b1</span> <span class='op'>=</span> <span class='const'>AlchemyFlux</span><span class='op'>::</span><span class='const'>Service</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span>
  <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Hello </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span>
<span class='kw'>end</span>

<span class='id identifier rubyid_service_a'>service_a</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>
<span class='id identifier rubyid_service_b'>service_b</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span>

<span class='comment'># Synchronous message
</span><span class='id identifier rubyid_response'>response</span> <span class='op'>=</span> <span class='id identifier rubyid_service_a1'>service_a1</span><span class='period'>.</span><span class='id identifier rubyid_send_message_to_service'>send_message_to_service</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Alice</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span>
<span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='comment'># Hello Alice
</span>
<span class='comment'># Asynchronous message
</span><span class='id identifier rubyid_service_a1'>service_a1</span><span class='period'>.</span><span class='id identifier rubyid_send_message_to_service'>send_message_to_service</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>B</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Bob</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_response'>response</span><span class='op'>|</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_response'>response</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>body</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span> <span class='comment'># Hello Bob
</span><span class='kw'>end</span>

<span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='int'>1</span><span class='rparen'>)</span> <span class='comment'># wait for asynchronous message to complete
</span>
<span class='id identifier rubyid_service_a'>service_a</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span>
<span class='id identifier rubyid_service_b'>service_b</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span>
</code></pre>

<h2 id="label-Documentation">Documentation</h2>

<p>The documentation for Alchemy Flux is generated by <a
href="https://rubygems.org/gems/yard/versions/0.8.7.6">yard</a>.</p>

<h2 id="label-Examples">Examples</h2>

<p>Example sending a message:</p>

<pre class="code ruby"><code class="ruby"><span class='id identifier rubyid_bundle'>bundle</span> <span class='id identifier rubyid_exec'>exec</span> <span class='id identifier rubyid_ruby'>ruby</span> <span class='id identifier rubyid_examples'>examples</span><span class='op'>/</span><span class='id identifier rubyid_example_1_send_message'>example_1_send_message</span><span class='period'>.</span><span class='id identifier rubyid_rb'>rb</span>
</code></pre>

<h2 id="label-Contributors">Contributors</h2>
<ul><li>
<p>Graham Jenson</p>
</li><li>
<p>Tom Cully</p>
</li></ul>
</div></div>

    <div id="footer">
  Generated on Wed Jan 20 16:39:03 2016 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.3).
</div>

  </body>
</html>