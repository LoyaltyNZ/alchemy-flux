<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: AlchemyFlux::Service
  
    &mdash; Documentation by YARD 0.9.36
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "AlchemyFlux::Service";
  relpath = '../';
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../AlchemyFlux.html" title="AlchemyFlux (module)">AlchemyFlux</a></span></span>
     &raquo; 
    <span class="title">Service</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: AlchemyFlux::Service
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">AlchemyFlux::Service</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/alchemy-flux.rb</dd>
  </dl>
  
</div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An Alchemy Flux Service</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small><a href="#" class="summary_toggle">collapse</a></small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#processing_messages-instance_method" title="#processing_messages (instance method)">#<strong>processing_messages</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The incoming number of messages being processed.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#state-instance_method" title="#state (instance method)">#<strong>state</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The current state of the Service, either <strong>stopped</strong> or <strong>started</strong>.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#transactions-instance_method" title="#transactions (instance method)">#<strong>transactions</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The outgoing message transactions.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Class Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generateUUID-class_method" title="generateUUID (class method)">.<strong>generateUUID</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generate a UUID string.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-class_method" title="start (class method)">.<strong>start</strong>(ampq_uri = &#39;amqp://127.0.0.1&#39;, threadpool_size = 500)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Start the EventMachine and AMQP connections for all Services.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-class_method" title="stop (class method)">.<strong>stop</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stop EventMachine and the.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(name, options = {}, &amp;block)  &#x21d2; Service </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a AlchemyFlux service instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#inspect-instance_method" title="#inspect (instance method)">#<strong>inspect</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>overriding inspect.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_message_to_resource-instance_method" title="#send_message_to_resource (instance method)">#<strong>send_message_to_resource</strong>(message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>send a message to a resource, this does not wait for a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_message_to_service-instance_method" title="#send_message_to_service (instance method)">#<strong>send_message_to_service</strong>(service_name, message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>send a message to a service, this does not wait for a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_request_to_resource-instance_method" title="#send_request_to_resource (instance method)">#<strong>send_request_to_resource</strong>(message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>send a message to a resource.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#send_request_to_service-instance_method" title="#send_request_to_service (instance method)">#<strong>send_request_to_service</strong>(service_name, message)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>send a request to a service, this will wait for a response.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#start-instance_method" title="#start (instance method)">#<strong>start</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>start the service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#stop-instance_method" title="#stop (instance method)">#<strong>stop</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stop the Service.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_s-instance_method" title="#to_s (instance method)">#<strong>to_s</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>overriding to_s.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(name, options = {}, &amp;block)  &#x21d2; <tt><span class='object_link'><a href="" title="AlchemyFlux::Service (class)">Service</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a AlchemyFlux service instance</p>

<p><code>name</code> the name of the service being created <code>options</code></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 43</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_options'>options</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span><span class='comma'>,</span> <span class='op'>&amp;</span><span class='id identifier rubyid_block'>block</span><span class='rparen'>)</span>
  <span class='ivar'>@name</span> <span class='op'>=</span> <span class='id identifier rubyid_name'>name</span>
  <span class='ivar'>@options</span> <span class='op'>=</span> <span class='lbrace'>{</span>
      <span class='label'>ampq_uri:</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>amqp://127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span>
      <span class='label'>prefetch:</span> <span class='int'>20</span><span class='comma'>,</span>
      <span class='label'>timeout:</span> <span class='int'>1000</span><span class='comma'>,</span>
      <span class='label'>threadpool_size:</span> <span class='int'>500</span><span class='comma'>,</span>
      <span class='label'>resource_paths:</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_merge'>merge</span><span class='lparen'>(</span><span class='id identifier rubyid_options'>options</span><span class='rparen'>)</span>

  <span class='ivar'>@service_fn</span> <span class='op'>=</span> <span class='id identifier rubyid_block'>block</span> <span class='op'>||</span> <span class='const'>Proc</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_message'>message</span><span class='op'>|</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span> <span class='rbrace'>}</span>

  <span class='ivar'>@uuid</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='ivar'>@name</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="../AlchemyFlux.html" title="AlchemyFlux (module)">AlchemyFlux</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="" title="AlchemyFlux::Service (class)">Service</a></span></span><span class='period'>.</span><span class='id identifier rubyid_generateUUID'><span class='object_link'><a href="#generateUUID-class_method" title="AlchemyFlux::Service.generateUUID (method)">generateUUID</a></span></span><span class='lparen'>(</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@transactions</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='ivar'>@processing_messages</span> <span class='op'>=</span> <span class='int'>0</span>

  <span class='ivar'>@response_queue_name</span> <span class='op'>=</span> <span class='ivar'>@uuid</span>
  <span class='ivar'>@service_queue_name</span> <span class='op'>=</span> <span class='ivar'>@name</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:stopped</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="processing_messages-instance_method">
  
    #<strong>processing_messages</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The incoming number of messages being processed</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


31
32
33</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 31</span>

<span class='kw'>def</span> <span class='id identifier rubyid_processing_messages'>processing_messages</span>
  <span class='ivar'>@processing_messages</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="state-instance_method">
  
    #<strong>state</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The current state of the Service, either <strong>stopped</strong> or <strong>started</strong></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


25
26
27</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 25</span>

<span class='kw'>def</span> <span class='id identifier rubyid_state'>state</span>
  <span class='ivar'>@state</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="transactions-instance_method">
  
    #<strong>transactions</strong>  &#x21d2; <tt>Object</tt>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The outgoing message transactions</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


28
29
30</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 28</span>

<span class='kw'>def</span> <span class='id identifier rubyid_transactions'>transactions</span>
  <span class='ivar'>@transactions</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="generateUUID-class_method">
  
    .<strong>generateUUID</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generate a UUID string</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


34
35
36</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 34</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_generateUUID'>generateUUID</span>
  <span class='const'>UUIDTools</span><span class='op'>::</span><span class='const'>UUID</span><span class='period'>.</span><span class='id identifier rubyid_random_create'>random_create</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='lparen'>(</span><span class='int'>16</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_ljust'>ljust</span><span class='lparen'>(</span><span class='int'>32</span><span class='comma'>,</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>0</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-class_method">
  
    .<strong>start</strong>(ampq_uri = &#39;amqp://127.0.0.1&#39;, threadpool_size = 500)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Start the EventMachine and AMQP connections for all Services</p>

<p>The application has two or more threads</p>
<ol><li>
<p>The Controller Thread (e.g. the rspec thread)</p>
</li><li>
<p>The EM Thread</p>
</li><li>
<p>The EM defer Threads</p>
</li></ol>

<p>When we start a Service we do it in a Thread so that it will not block the calling Thread</p>

<p>When the FIRST Service is started EM.run initialises in that Thread When the second Service is initialises the block is executed in the new thread, but all the callbacks will be executed in the EM thread</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 90</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_ampq_uri'>ampq_uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>amqp://127.0.0.1</span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_threadpool_size'>threadpool_size</span><span class='op'>=</span><span class='int'>500</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_reactor_running?'>reactor_running?</span>
  <span class='id identifier rubyid_start_blocker'>start_blocker</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='kw'>do</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>EM Thread</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_reactor_thread?'>reactor_thread?</span>
    <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_current'>current</span><span class='period'>.</span><span class='id identifier rubyid_abort_on_exception'>abort_on_exception</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_threadpool_size'>threadpool_size</span> <span class='op'>=</span> <span class='id identifier rubyid_threadpool_size'>threadpool_size</span>
    <span class='const'>AMQP</span><span class='period'>.</span><span class='id identifier rubyid_start'>start</span><span class='lparen'>(</span><span class='id identifier rubyid_ampq_uri'>ampq_uri</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_connection'>connection</span><span class='op'>|</span>
      <span class='cvar'>@@connection</span> <span class='op'>=</span> <span class='id identifier rubyid_connection'>connection</span>
      <span class='cvar'>@@connection</span><span class='period'>.</span><span class='id identifier rubyid_on_error'>on_error</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_conn'>conn</span><span class='comma'>,</span> <span class='id identifier rubyid_connection_close'>connection_close</span><span class='op'>|</span>
        <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Channel exception: [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connection_close'>connection_close</span><span class='period'>.</span><span class='id identifier rubyid_reply_code'>reply_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_connection_close'>connection_close</span><span class='period'>.</span><span class='id identifier rubyid_reply_text'>reply_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_message'>message</span>
        <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_message'>message</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_start_blocker'>start_blocker</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:unblock</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_start_blocker'>start_blocker</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-class_method">
  
    .<strong>stop</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stop EventMachine and the</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


111
112
113
114
115
116
117
118
119
120
121
122</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 111</span>

<span class='kw'>def</span> <span class='kw'>self</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='op'>!</span><span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_reactor_running?'>reactor_running?</span>
  <span class='id identifier rubyid_stop_blocker'>stop_blocker</span> <span class='op'>=</span> <span class='const'>Queue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='comment'>#last tick
</span>  <span class='const'>AMQP</span><span class='period'>.</span><span class='id identifier rubyid_stop'>stop</span> <span class='kw'>do</span>
    <span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_stop_event_loop'>stop_event_loop</span>
    <span class='id identifier rubyid_stop_blocker'>stop_blocker</span> <span class='op'>&lt;&lt;</span> <span class='symbol'>:unblock</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_stop_blocker'>stop_blocker</span><span class='period'>.</span><span class='id identifier rubyid_pop'>pop</span>
  <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.05</span><span class='rparen'>)</span> <span class='comment'># to ensure it finished
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="inspect-instance_method">
  
    #<strong>inspect</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>overriding inspect</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


65
66
67</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 65</span>

<span class='kw'>def</span> <span class='id identifier rubyid_inspect'>inspect</span>
  <span class='id identifier rubyid_to_s'>to_s</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_message_to_resource-instance_method">
  
    #<strong>send_message_to_resource</strong>(message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>send a message to a resource, this does not wait for a response</p>
<dl class="rdoc-list note-list"><dt><strong>message</strong>
<dd>
<p>HTTP formatted message to be sent, must contain ‘’path’‘ key with URL path</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


313
314
315
316</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 313</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_message_to_resource'>send_message_to_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_routing_key'>routing_key</span> <span class='op'>=</span> <span class='id identifier rubyid_path_to_routing_key'>path_to_routing_key</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>path</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_HTTP_message'>send_HTTP_message</span><span class='lparen'>(</span><span class='ivar'>@resources_exchange</span><span class='comma'>,</span> <span class='id identifier rubyid_routing_key'>routing_key</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_message_to_service-instance_method">
  
    #<strong>send_message_to_service</strong>(service_name, message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>send a message to a service, this does not wait for a response</p>
<dl class="rdoc-list note-list"><dt><strong>service_name</strong>
<dd>
<p>The name of the service</p>
</dd><dt><strong>message</strong>
<dd>
<p>The message to be sent</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


306
307
308</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 306</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_message_to_service'>send_message_to_service</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_send_HTTP_message'>send_HTTP_message</span><span class='lparen'>(</span><span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_default_exchange'>default_exchange</span><span class='comma'>,</span> <span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_request_to_resource-instance_method">
  
    #<strong>send_request_to_resource</strong>(message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>send a message to a resource</p>
<dl class="rdoc-list note-list"><dt><strong>message</strong>
<dd>
<p>HTTP formatted message to be sent, must contain ‘’path’‘ key with URL path</p>
</dd></dl>

<p>This method can optionally take a block which will be executed asynchronously and yielded the response</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


339
340
341
342
343
344
345
346
347
348</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 339</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_request_to_resource'>send_request_to_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_routing_key'>routing_key</span> <span class='op'>=</span> <span class='id identifier rubyid_path_to_routing_key'>path_to_routing_key</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>path</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_defer'>defer</span> <span class='kw'>do</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_send_request_to_resource'>send_request_to_resource</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_send_HTTP_request'>send_HTTP_request</span><span class='lparen'>(</span><span class='ivar'>@resources_exchange</span><span class='comma'>,</span> <span class='id identifier rubyid_routing_key'>routing_key</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="send_request_to_service-instance_method">
  
    #<strong>send_request_to_service</strong>(service_name, message)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>send a request to a service, this will wait for a response</p>
<dl class="rdoc-list note-list"><dt><strong>service_name</strong>
<dd>
<p>the name of the service</p>
</dd><dt><strong>message</strong>
<dd>
<p>the message to be sent</p>
</dd></dl>

<p>This method can optionally take a block which will be executed asynchronously and yielded the response</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


324
325
326
327
328
329
330
331
332</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 324</span>

<span class='kw'>def</span> <span class='id identifier rubyid_send_request_to_service'>send_request_to_service</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_block_given?'>block_given?</span>
    <span class='const'>EventMachine</span><span class='period'>.</span><span class='id identifier rubyid_defer'>defer</span> <span class='kw'>do</span>
      <span class='kw'>yield</span> <span class='id identifier rubyid_send_request_to_service'>send_request_to_service</span><span class='lparen'>(</span><span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_send_HTTP_request'>send_HTTP_request</span><span class='lparen'>(</span><span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_default_exchange'>default_exchange</span><span class='comma'>,</span> <span class='id identifier rubyid_service_name'>service_name</span><span class='comma'>,</span> <span class='id identifier rubyid_message'>message</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="start-instance_method">
  
    #<strong>start</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>start the service</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 125</span>

<span class='kw'>def</span> <span class='id identifier rubyid_start'>start</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@state</span> <span class='op'>!=</span> <span class='symbol'>:stopped</span>

  <span class='const'><span class='object_link'><a href="" title="AlchemyFlux::Service (class)">Service</a></span></span><span class='period'>.</span><span class='id identifier rubyid_start'><span class='object_link'><a href="#start-class_method" title="AlchemyFlux::Service.start (method)">start</a></span></span><span class='lparen'>(</span><span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:ampq_uri</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:threadpool_size</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='const'>EM</span><span class='period'>.</span><span class='id identifier rubyid_run'>run</span> <span class='kw'>do</span>

    <span class='ivar'>@channel</span> <span class='op'>=</span> <span class='const'>AMQP</span><span class='op'>::</span><span class='const'>Channel</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='cvar'>@@connection</span><span class='rparen'>)</span>

    <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_on_error'>on_error</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_ch'>ch</span><span class='comma'>,</span> <span class='id identifier rubyid_channel_close'>channel_close</span><span class='op'>|</span>
      <span class='id identifier rubyid_message'>message</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Channel exception: [</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_channel_close'>channel_close</span><span class='period'>.</span><span class='id identifier rubyid_reply_code'>reply_code</span><span class='embexpr_end'>}</span><span class='tstring_content'>] </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_channel_close'>channel_close</span><span class='period'>.</span><span class='id identifier rubyid_reply_text'>reply_text</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_message'>message</span>
      <span class='id identifier rubyid_raise'>raise</span> <span class='id identifier rubyid_message'>message</span>
    <span class='kw'>end</span>

    <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_prefetch'>prefetch</span><span class='lparen'>(</span><span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:prefetch</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_auto_recovery'>auto_recovery</span> <span class='op'>=</span> <span class='kw'>true</span>

    <span class='ivar'>@service_queue</span> <span class='op'>=</span> <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_queue'>queue</span><span class='lparen'>(</span> <span class='ivar'>@service_queue_name</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:durable</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@service_queue</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='symbol'>:ack</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_metadata'>metadata</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='op'>|</span>
      <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_process_service_queue_message'>process_service_queue_message</span><span class='lparen'>(</span><span class='id identifier rubyid_metadata'>metadata</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_response_queue'>response_queue</span> <span class='op'>=</span> <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_queue'>queue</span><span class='lparen'>(</span><span class='ivar'>@response_queue_name</span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:exclusive</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:auto_delete</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_response_queue'>response_queue</span><span class='period'>.</span><span class='id identifier rubyid_subscribe'>subscribe</span><span class='lparen'>(</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_metadata'>metadata</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='op'>|</span>
      <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_process_response_queue_message'>process_response_queue_message</span><span class='lparen'>(</span><span class='id identifier rubyid_metadata'>metadata</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_default_exchange'>default_exchange</span><span class='period'>.</span><span class='id identifier rubyid_on_return'>on_return</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_basic_return'>basic_return</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='op'>|</span>
      <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_process_returned_message'>process_returned_message</span><span class='lparen'>(</span><span class='id identifier rubyid_basic_return'>basic_return</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_properties'>properties</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='comment'># RESOURCES HANDLE
</span>    <span class='ivar'>@resources_exchange</span> <span class='op'>=</span> <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>resources.exchange</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='lbrace'>{</span><span class='symbol'>:durable</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rbrace'>}</span><span class='rparen'>)</span>
    <span class='ivar'>@resources_exchange</span><span class='period'>.</span><span class='id identifier rubyid_on_return'>on_return</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_basic_return'>basic_return</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='op'>|</span>
      <span class='id identifier rubyid_payload'>payload</span> <span class='op'>=</span> <span class='const'>JSON</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_process_returned_message'>process_returned_message</span><span class='lparen'>(</span><span class='id identifier rubyid_basic_return'>basic_return</span><span class='comma'>,</span> <span class='id identifier rubyid_frame'>frame</span><span class='period'>.</span><span class='id identifier rubyid_properties'>properties</span><span class='comma'>,</span> <span class='id identifier rubyid_payload'>payload</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_bound_resources'>bound_resources</span> <span class='op'>=</span> <span class='int'>0</span>
    <span class='kw'>for</span> <span class='id identifier rubyid_resource_path'>resource_path</span> <span class='kw'>in</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:resource_paths</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_binding_key'>binding_key</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_path_to_routing_key'>path_to_routing_key</span><span class='lparen'>(</span><span class='id identifier rubyid_resource_path'>resource_path</span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'>.#</span><span class='tstring_end'>&quot;</span></span>
      <span class='ivar'>@service_queue</span><span class='period'>.</span><span class='id identifier rubyid_bind'>bind</span><span class='lparen'>(</span><span class='ivar'>@resources_exchange</span><span class='comma'>,</span> <span class='symbol'>:key</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_binding_key'>binding_key</span><span class='rparen'>)</span> <span class='lbrace'>{</span>
        <span class='id identifier rubyid_bound_resources'>bound_resources</span> <span class='op'>+=</span> <span class='int'>1</span>
      <span class='rbrace'>}</span>
    <span class='kw'>end</span>
    <span class='kw'>begin</span>
      <span class='comment'># simple loop to wait for the resources to be bound
</span>      <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.01</span><span class='rparen'>)</span>
    <span class='kw'>end</span> <span class='kw'>until</span> <span class='id identifier rubyid_bound_resources'>bound_resources</span> <span class='op'>==</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:resource_paths</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span>

    <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:started</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="stop-instance_method">
  
    #<strong>stop</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stop the Service</p>

<p>This method:</p>
<ul><li>
<p>Stops receiving new messages</p>
</li><li>
<p>waits for processing incoming and outgoing messages to be completed</p>
</li><li>
<p>close the channel</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


188
189
190
191
192
193
194
195
196
197
198
199
200
201
202</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 188</span>

<span class='kw'>def</span> <span class='id identifier rubyid_stop'>stop</span>
  <span class='kw'>return</span> <span class='kw'>if</span> <span class='ivar'>@state</span> <span class='op'>!=</span> <span class='symbol'>:started</span>
  <span class='comment'># stop receiving new incoming messages
</span>  <span class='ivar'>@service_queue</span><span class='period'>.</span><span class='id identifier rubyid_unsubscribe'>unsubscribe</span>
  <span class='comment'># only stop the service if all incoming and outgoing messages are complete
</span>  <span class='id identifier rubyid_decisecond_timeout'>decisecond_timeout</span> <span class='op'>=</span> <span class='ivar'>@options</span><span class='lbracket'>[</span><span class='symbol'>:timeout</span><span class='rbracket'>]</span><span class='op'>/</span><span class='int'>100</span>
  <span class='id identifier rubyid_waited_deciseconds'>waited_deciseconds</span> <span class='op'>=</span> <span class='int'>0</span> <span class='comment'># guarantee that this loop will stop
</span>  <span class='kw'>while</span> <span class='lparen'>(</span><span class='ivar'>@transactions</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span> <span class='op'>&gt;</span> <span class='int'>0</span> <span class='op'>||</span> <span class='ivar'>@processing_messages</span> <span class='op'>&gt;</span> <span class='int'>0</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_waited_deciseconds'>waited_deciseconds</span> <span class='op'>&lt;</span> <span class='id identifier rubyid_decisecond_timeout'>decisecond_timeout</span>
    <span class='id identifier rubyid_sleep'>sleep</span><span class='lparen'>(</span><span class='float'>0.1</span><span class='rparen'>)</span> <span class='comment'># wait a decisecond to check the incoming and outgoing messages again
</span>    <span class='id identifier rubyid_waited_deciseconds'>waited_deciseconds</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='kw'>end</span>

  <span class='ivar'>@channel</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='ivar'>@state</span> <span class='op'>=</span> <span class='symbol'>:stopped</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_s-instance_method">
  
    #<strong>to_s</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>overriding to_s</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/alchemy-flux.rb', line 70</span>

<span class='kw'>def</span> <span class='id identifier rubyid_to_s'>to_s</span>
  <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>AlchemyFlux::Service(</span><span class='embexpr_beg'>#{</span><span class='ivar'>@name</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='ivar'>@options</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Fri Jun 14 13:47:41 2024 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.36 (ruby-3.3.0).
</div>

    </div>
  </body>
</html>